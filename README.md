# Hookman - Git Hooks Manager

[![Tests](https://github.com/fcoury/hookman/actions/workflows/tests.yml/badge.svg)](https://github.com/fcoury/hookman/actions/workflows/tests.yml)
[![CI](https://github.com/fcoury/hookman/actions/workflows/ci.yml/badge.svg)](https://github.com/fcoury/hookman/actions/workflows/ci.yml)

A command-line tool for managing Git hooks across projects with a simple, declarative configuration.

## Overview

Hookman allows you to:
- Define Git hooks in a version-controlled `.hookman` directory
- Manage multiple commands per hook type
- Apply hook configurations to any Git repository
- Share hook configurations with your team

## Development Guide

### Architecture

```
hookman/
├── src/
│   ├── main.rs           # CLI entry point
│   ├── cli.rs            # Command definitions (clap)
│   ├── commands/         # Command implementations
│   │   ├── mod.rs
│   │   ├── init.rs       # Initialize .hookman directory
│   │   ├── add.rs        # Add command to hook
│   │   ├── remove.rs     # Remove command from hook
│   │   ├── list.rs       # List hooks and commands
│   │   ├── apply.rs      # Apply hooks to git
│   │   └── status.rs     # Show current status
│   ├── models/           # Data structures
│   │   ├── mod.rs
│   │   ├── hook.rs       # Hook representation
│   │   ├── command.rs    # Command representation
│   │   └── config.rs     # Configuration
│   ├── storage/          # File I/O operations
│   │   ├── mod.rs
│   │   └── toml.rs       # TOML parsing/writing
│   ├── generator/        # Hook script generation
│   │   ├── mod.rs
│   │   └── script.rs     # Shell script builder
│   └── error.rs          # Error types
├── tests/                # Integration tests
├── Cargo.toml
└── README.md
```

### Data Model

```rust
// Hook types supported by Git
enum HookType {
    PreCommit,
    PrePush,
    CommitMsg,
    PostCommit,
    PreRebase,
    PostCheckout,
    PostMerge,
    PreReceive,
    Update,
    PostReceive,
}

// Individual command within a hook
struct Command {
    id: String,           // Unique identifier
    command: String,      // Shell command to execute
    description: String,  // Human-readable description
}

// Hook configuration
struct Hook {
    hook_type: HookType,
    commands: Vec<Command>,
}
```

### Storage Format

Configuration files are stored in TOML format:

```toml
# .hookman/hooks/pre-commit.toml
[[commands]]
id = "format"
command = "cargo fmt -- --check"
description = "Check Rust code formatting"

[[commands]]
id = "lint"
command = "cargo clippy -- -D warnings"
description = "Run Clippy linter"

[[commands]]
id = "test"
command = "cargo test"
description = "Run unit tests"
```

### CLI Commands

#### `hookman init`
Initialize a new `.hookman` directory in the current Git repository.

```bash
hookman init
```

#### `hookman add <hook-type> <command>`
Add a command to a specific hook type.

```bash
hookman add pre-commit "cargo fmt -- --check" --id format --description "Check formatting"
```

#### `hookman remove <hook-type> <command-id>`
Remove a command from a hook.

```bash
hookman remove pre-commit format
```

#### `hookman list [hook-type]`
List all hooks or commands for a specific hook.

```bash
hookman list              # List all hooks
hookman list pre-commit   # List pre-commit commands
```

#### `hookman apply`
Apply the hook configuration to the Git repository.

```bash
hookman apply             # Apply all hooks
hookman apply --dry-run   # Show what would be done
```

#### `hookman status`
Show the current hook configuration status.

```bash
hookman status
```

### Generated Hook Scripts

Hookman generates shell scripts in `.git/hooks/`:

```bash
#!/bin/sh
# Generated by hookman
# DO NOT EDIT - This file is managed by hookman

set -e  # Exit on first error

echo "Running pre-commit hooks..."

# format: Check Rust code formatting
echo "  → format: Check Rust code formatting"
cargo fmt -- --check

# lint: Run Clippy linter
echo "  → lint: Run Clippy linter"
cargo clippy -- -D warnings

# test: Run unit tests
echo "  → test: Run unit tests"
cargo test

echo "All pre-commit hooks passed!"
```

### Implementation Steps

1. **Core Structure** (Week 1)
   - Set up project with dependencies
   - Implement basic CLI with clap
   - Create data models
   - Implement TOML storage

2. **Basic Commands** (Week 2)
   - Implement `init` command
   - Implement `add` command
   - Implement `list` command
   - Add error handling

3. **Advanced Features** (Week 3)
   - Implement `remove` command
   - Implement `apply` command with script generation
   - Add `status` command
   - Implement dry-run mode

4. **Polish & Testing** (Week 4)
   - Add comprehensive tests
   - Improve error messages
   - Add colored output
   - Write documentation

### Dependencies

```toml
[dependencies]
clap = { version = "4.0", features = ["derive"] }
serde = { version = "1.0", features = ["derive"] }
toml = "0.8"
anyhow = "1.0"
thiserror = "1.0"
colored = "2.0"
walkdir = "2.0"
```

### Testing Strategy

1. **Unit Tests**: Test individual functions and modules
2. **Integration Tests**: Test command workflows
3. **End-to-End Tests**: Test actual Git hook execution

### Error Handling

- Use `anyhow::Result` for command functions
- Use `thiserror` for custom error types
- Provide helpful error messages with context
- Validate Git repository before operations

### Future Enhancements

- [ ] Hook templates/presets
- [ ] Global hooks configuration
- [ ] Hook execution ordering
- [ ] Conditional hook execution
- [ ] Hook environment variables
- [ ] Remote hook sharing (Git URLs)
- [ ] Hook testing framework
- [ ] Performance metrics

## Platform Support

Hookman is primarily developed for Unix-like systems (Linux, macOS). Windows support is limited:

- ✅ Full support on Linux and macOS
- ⚠️  Limited support on Windows (Git Bash recommended)
- ⚠️  On Windows, hook scripts may need manual executable permissions

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## License

MIT